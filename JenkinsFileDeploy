pipeline {
  agent any

  parameters {
    string(name: 'WAR_FILE_NAME', defaultValue: 'sample.war', description: 'Name of the WAR file to deploy')
  }

  environment {
    TOMCAT_URL = 'http://54.74.253.1:8080'
  }

  stages {
    stage('Fetch WAR') {
      steps {
        echo "Fetching ${params.WAR_FILE_NAME} from GitHub Actions artifact storage (if applicable)"
        
        // Option 1: if GitHub pushes the WAR somewhere accessible (e.g., S3, artifact repo)
        // you could add a wget/curl step here to download it.

        // For demo purposes, we’ll assume the WAR is already present in Jenkins workspace
        sh 'ls -lh *.war || echo "No WAR found yet"'
      }
    }

    stage('Deploy to Tomcat') {
      steps {
        echo "Deploying ${params.WAR_FILE_NAME} to Tomcat..."
        deploy adapters: [
          tomcat9(
            credentialsId: 'tomcat-credentials',
            path: '',
            url: "${TOMCAT_URL}"
          )
        ],
        contextPath: '/sample1',
        war: "${params.WAR_FILE_NAME}"
      }
    }
  }

  post {
    success {
      echo "✅ Deployment of ${params.WAR_FILE_NAME} completed successfully!"
    }
    failure {
      echo "❌ Deployment failed."
    }
  }
}
